window.onload =
    function () {
        function i(e, t, i) {
            var n = new XMLHttpRequest;
            n.open("POST", e, !0), n.setRequestHeader("Content-Type", "application/json"), n.addEventListener("load",
                function () { i(n.status < 400 ? n.responseText : n.status) }), n.send(JSON.stringify(t))
        }
        function n() {
            var e = document.getElementById("myTopnav");
            e.classList.contains("res") ? e.classList.remove("res") : e.classList.add("res")
        }
        function o(e) {
            return document.getElementById(e).value
        }
        function s(e) {
            for (var t = document.getElementById(e), i = 0; i < t.options.length; i++)
                if (t.options[i].selected)
                    return t.options[i].value
        }
        function l() {
            document.cookie = "id=", location.href = "/login.html"
        }
        function a(e) {
            for (var t = ["mqtt_time", "mqtt_server", "mqtt_port", "mqtt_login", "mqtt_pass"], i = 0; i < t.length; i++)
                document.getElementById(t[i]).disabled = e, e && (document.getElementById(t[i]).value = "")
        }
        function r() {
            var t = { init: "save" },
                n = !1,
                l = ["wifi_id", "wifi_pass", "wifi_mode", "auth_pass", "auth_login", "auth", "mqtt_port", "mqtt_pass", "mqtt_server", "mqtt", "mqtt_login", "mqtt_time"];
            if (l.forEach(
                function (e) {
                "wifi_mode" == e || "auth" == e || "mqtt" == e ?
                t[e] = s(e) :
                "ON" == s("mqtt") ?
                (("mqtt_time" == e || "mqtt_server" == e || "mqtt_port" == e) && ("" !== o(e) ?
                document.getElementById(e).style.borderColor = "#bbb" :
                (n = !0, document.getElementById(e).style.borderColor = "red")), t[e] = o(e)) :
                t[e] = o(e)
            }), n)
                return void (e.style.display = "none");
            if ("OFF" == s("wifi_mode")) {
                var a = confirm("Внимание!!! Wi-fi будет отключен, Вы точно этого хотите?");
                if (!a)
                    return
            }
            e.style.opacity = "0", setTimeout(
                function () {
                    e.style.display = "none"
                }, 600), i("web_control.lua", t,
                function (e) {
                    (e = "true") && i("web_control.lua", { init: "reboot" },
                        function () {
                            setTimeout(
                                function () { location.href = "/" }, 1e4)
                        })
                })
        }
        function u() {
            c > 4 && (c = 0), document.getElementById("search").value = d[c], c += 1
        }

        function m() {
            t = setInterval(u, 200), i("web_control.lua", { init: "scan" }, function () { }), setTimeout(
                                            function () {
                                                var e = document.getElementById("list"); i("web_control.lua", { init: "get" },
                                                    function (i) {
                                                        if (i) {
                                                            clearInterval(t), c = 0, document.getElementById("search").value = "Поиск";
                                                            try {
                                                                for (var n = JSON.parse(i), o = 0; o < n.length; o++)
                                                                    0 == o ?
                                                                    e.innerHTML = '<li id="' + n[o].sd + '"><b>' + n[o].sd + "</b> rssi : " + n[o].ri + " channel : " + n[o].cl + "</li>" :
                                                                    e.innerHTML += '<li id="' + n[o].sd + '"><b>' + n[o].sd + "</b> rssi : " + n[o].ri + " channel : " + n[o].cl + "</li>"
                                                            }
                                                            catch (s) {
                                                                e.innerHTML = "<li>Сеть не найдена</li>"
                                                            } e.style.display = "block"
                                                        }
                                                    })
                                            }, 5e3)
        }

        var t, e = document.getElementById("Modal");
        "OFF" == s("mqtt") && a(!0);
        var d = ["|", "(|", "((|", "(((|", "((((|"], c = 0;

        document.body.addEventListener("click",
            function (t) {
                var i = document.getElementById("list");
                "search" == t.target.id ? m() :
                "btn_nav" == t.target.id ? n() :
                "btn_exit" == t.target.id ? l() :
                "btn_save" == t.target.id ? (e.style.opacity = "1", e.style.display = "block") :
                "close_m" == t.target.id | "close" == t.target.id ? (e.style.opacity = "0", setTimeout(
                    function () { e.style.display = "none" }, 600)) :
                "save_m" == t.target.id ? r() :
                "mqtt" == t.target.id ? a("OFF" == s("mqtt") ? !0 : !1) :
                ("LI" == t.target.tagName && t.target.id && (document.getElementById("wifi_id").value = t.target.id, document.getElementById("wifi_pass").value = "", document.getElementById("wifi_pass").focus(), document.getElementById("wifi_mode").options[1].selected = "true"), i.style.display = "none")
            })
    };